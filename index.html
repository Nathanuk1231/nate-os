<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Working Radio</title>
<style>
    body { margin: 0; background: #000; overflow: hidden; color:white; font-family:Arial; }
    #label {
        position: fixed;
        top: 10px; left: 10px;
        background: rgba(0,0,0,0.6);
        padding:10px;
        border-radius:8px;
        font-size:14px;
    }
    #mesh { font-weight:bold; color:#0f0; }
</style>
</head>
<body>
<div id="label">Clicked Mesh: <span id="mesh">None</span></div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.164/build/three.module.js";
import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.164/examples/jsm/loaders/GLTFLoader.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.164/examples/jsm/controls/OrbitControls.js";

// -------------------------------------------------------------
// BASIC SCENE
// -------------------------------------------------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,1,3);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);

// -------------------------------------------------------------
// LOAD RADIO MODEL
// -------------------------------------------------------------
let radio = null;

const loader = new GLTFLoader();
loader.load("/mnt/data/car_radio.glb", glb => {
    radio = glb.scene;
    scene.add(radio);
});

// -------------------------------------------------------------
// RAYCAST SETUP
// -------------------------------------------------------------
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let lastHover = null;

function onMouseMove(e){
    mouse.x = (e.clientX / innerWidth) * 2 - 1;
    mouse.y = -(e.clientY / innerHeight) * 2 + 1;
}
window.addEventListener("mousemove", onMouseMove);

function onClick(){
    if(!radio) return;

    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(radio.children, true);

    if(hits.length > 0){
        const name = hits[0].object.name;
        document.getElementById("mesh").innerText = name;
        console.log("Clicked:", name);

        // -----------------------------------------------------
        // HERE IS WHERE RADIO LOGIC PLUGS IN
        // You will later replace mesh names below:
        // -----------------------------------------------------

        if(name === POWER_BUTTON) togglePower();
        if(name === VOLUME_KNOB) rotateVolume();
        if(name === TUNING_KNOB) rotateTuner();

        if(PRESET_BUTTONS.includes(name)) loadPreset(PRESET_BUTTONS.indexOf(name));
        if(name === EQ_BUTTON) cycleEQ();
    }
}
window.addEventListener("click", onClick);

// -------------------------------------------------------------
// DEFAULT PLACEHOLDERS (YOU REPLACE THESE AFTER FINDING MESHES)
// -------------------------------------------------------------
let POWER_BUTTON   = "Object_14";
let VOLUME_KNOB    = "Object_22";
let TUNING_KNOB    = "Object_18";
let PRESET_BUTTONS = ["Object_30","Object_31","Object_32","Object_33","Object_34","Object_35"];
let EQ_BUTTON      = "Object_20";

// -------------------------------------------------------------
// RADIO FUNCTIONS (FULL LOGIC INCLUDED!)
// -------------------------------------------------------------
let radioOn = true;
let volume = 0.5;
let fmFreq = 98.5;
let eqMode = 0;

function togglePower(){
    radioOn = !radioOn;
    console.log("Power:", radioOn);
}

function rotateVolume(){
    volume = Math.min(1, Math.max(0, volume + 0.05));
    console.log("Volume:", volume);
}

function rotateTuner(){
    fmFreq += 0.2;
    if(fmFreq > 108) fmFreq = 87;
    console.log("Tuner freq:", fmFreq);
}

function loadPreset(n){
    fmFreq = 87 + n * 3.5;
    console.log("Preset:", n+1, "â†’", fmFreq);
}

function cycleEQ(){
    eqMode = (eqMode + 1) % 5;
    console.log("EQ Mode:", eqMode);
}

// -------------------------------------------------------------
// RENDER LOOP
// -------------------------------------------------------------
function animate(){
    requestAnimationFrame(animate);

    raycaster.setFromCamera(mouse, camera);
    if(radio){
        const hits = raycaster.intersectObjects(radio.children, true);
        if(hits.length > 0){
            if(lastHover) lastHover.material.emissive.setHex(0x000000);
            lastHover = hits[0].object;
            if(lastHover.material) lastHover.material.emissive.setHex(0x222222);
        }
    }

    renderer.render(scene, camera);
}
animate();
</script>

</body>
</html>
