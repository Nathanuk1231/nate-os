<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Working 3D Vintage Radio (Sketchfab)</title>
<style>
  :root{ --bg:#0b0b0b; --panel:#111; --accent:#d9b86a; --muted:#999;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#050505 0%, #0f0f11 100%);font-family:Inter,system-ui,Arial;}
  .wrap{max-width:1200px;margin:18px auto;padding:12px;display:grid;grid-template-columns:1fr 340px;gap:18px;}
  .viewer {
    background: #000; border-radius:12px; overflow:hidden; min-height:520px; position:relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  }
  /* Sketchfab iframe fills viewer */
  .viewer iframe{width:100%;height:100%;border:0;display:block;}

  .controls {
    background: linear-gradient(180deg,#0f1113,#0b0d0f);
    border-radius:12px;padding:18px;color:#eee;box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    display:flex;flex-direction:column;gap:12px;
  }

  .title { font-size:18px; font-weight:600; margin-bottom:6px; color:var(--accent); }
  .station { font-size:14px; color:#ddd; margin-bottom:8px; }
  .knobs { display:flex; gap:14px; align-items:center; justify-content:space-between; padding:8px 0; }
  .knob {
    width:110px;height:110px;border-radius:50%; background:linear-gradient(180deg,#222,#111);display:flex;
    align-items:center;justify-content:center;position:relative;cursor:grab;
    box-shadow: inset 0 -6px 12px rgba(0,0,0,0.6), 0 6px 14px rgba(0,0,0,0.5);
  }
  .knob:active{cursor:grabbing;}
  .knob .indicator { position:absolute; width:4px; height:38px; top:12px; left:50%; transform-origin:50% 90%; background:var(--accent); border-radius:2px; }
  .label { text-align:center;margin-top:8px;font-size:13px;color:var(--muted); }
  button.small { background:#16181a;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:#ddd;cursor:pointer; }
  .vu { height:8px;background:#222;border-radius:6px;overflow:hidden; }
  .vu > i { display:block;height:100%;width:0%;background:linear-gradient(90deg,#c7d83b,#f15a24);transition:width 120ms linear; }
  .stations-list{display:flex;flex-direction:column;gap:6px; max-height:160px; overflow:auto; padding-right:6px;}
  .station-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#ddd;text-align:left;cursor:pointer;}
  .attribution{font-size:12px;color:var(--muted); margin-top:6px;}
  .attribution a{color:var(--accent);text-decoration:none;}
  footer{max-width:1200px;margin:12px auto;color:#999;font-size:12px;padding:0 12px;}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr; padding:12px;}
    .controls{order:2;}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="viewer" id="viewer">
    <!-- Sketchfab embed (model from the link you gave) -->
    <!-- Model UID: 174423542ed8409aaac4ebefcaa8d0ae -->
    <iframe title="Car Radio - Sketchfab" src="https://sketchfab.com/models/174423542ed8409aaac4ebefcaa8d0ae/embed?autostart=0&preload=1"
      frameborder="0" allow="autoplay; fullscreen; vr" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe>
    <!-- If you prefer direct GLB loading later, we can swap this out for a Three.js GLTFLoader version -->
  </div>

  <aside class="controls">
    <div>
      <div class="title">Working 3D Vintage Radio</div>
      <div class="station" id="stationLabel">Station: —</div>
      <div class="vu"><i id="vuBar" style="width:0%"></i></div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;">
      <div style="flex:1">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">Tuning</div>
        <div class="knobs">
          <div class="knob" id="tuneKnob" data-angle="0" title="Drag to tune">
            <div class="indicator" id="tuneIndicator" style="transform:rotate(0deg)"></div>
          </div>
        </div>
        <div class="label">Rotate to change station</div>
      </div>

      <div style="width:120px">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">Volume</div>
        <div class="knob" id="volKnob" data-angle="-45" title="Drag to change volume">
          <div class="indicator" id="volIndicator" style="transform:rotate(-45deg)"></div>
        </div>
        <div class="label">Drag / click to mute</div>
      </div>
    </div>

    <div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:8px;">Stations</div>
      <div class="stations-list" id="stationsList"></div>
    </div>

    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="small" id="prevBtn">◀ Prev</button>
      <button class="small" id="playPauseBtn">Play</button>
      <button class="small" id="nextBtn">Next ▶</button>
    </div>

    <div class="attribution">
      Model: <a href="https://sketchfab.com/3d-models/car-radio-174423542ed8409aaac4ebefcaa8d0ae" target="_blank" rel="noopener">Car Radio by Nohal (xMatlies)</a> — CC BY-SA.
    </div>
  </aside>
</div>

<footer style="text-align:center;">
  Built with Sketchfab embed • Streams sourced from public archive sources for demo.
</footer>

<!-- Audio element kept hidden -->
<audio id="radio" crossorigin="anonymous"></audio>

<script>
/* ======= Stations (change or add your own URLs) =======
   Use CORS-friendly streams (some radio streams block cross-origin requests).
   I included example archive.org MP3s as reliable demo sources.
====================================================== */
const stations = [
  { name: "Old Time Radio — The Shadow (example)", url: "https://archive.org/download/OTR_Theater/OTR_Theatre1.mp3" },
  { name: "Vintage Mix (example)", url: "https://archive.org/download/OTR_Philadelphia_Theater/Phil_Radio_1.mp3" },
  { name: "Public Domain Music (example)", url: "https://archive.org/download/testmp3testfile/mpthreetest.mp3" }
];

const radio = document.getElementById('radio');
let idx = 0;
let playing = false;

const stationLabel = document.getElementById('stationLabel');
const stationsList = document.getElementById('stationsList');
const vuBar = document.getElementById('vuBar');

function populateStations(){
  stationsList.innerHTML = '';
  stations.forEach((s,i)=>{
    const btn = document.createElement('button');
    btn.className = 'station-btn';
    btn.textContent = (i+1) + ". " + s.name;
    btn.onclick = ()=> { setStation(i); startPlayback(); };
    stationsList.appendChild(btn);
  });
}
populateStations();

function setStation(i){
  idx = i;
  radio.src = stations[idx].url;
  stationLabel.textContent = "Station: " + stations[idx].name;
}

function startPlayback(){
  radio.play().catch(e=>{
    // autoplay might be blocked until user interacts — that's fine
    console.log("Playback blocked: user gesture required.", e);
  });
  playing = true;
  document.getElementById('playPauseBtn').textContent = "Pause";
}
function pausePlayback(){
  radio.pause();
  playing = false;
  document.getElementById('playPauseBtn').textContent = "Play";
}

document.getElementById('prevBtn').onclick = ()=>{
  idx = (idx - 1 + stations.length) % stations.length; setStation(idx); startPlayback();
};
document.getElementById('nextBtn').onclick = ()=>{
  idx = (idx + 1) % stations.length; setStation(idx); startPlayback();
};
document.getElementById('playPauseBtn').onclick = ()=>{
  if(!playing){ startPlayback() } else { pausePlayback() }
};

// init
setStation(0);

/* ======= Simple VU meter using WebAudio API ======= */
let audioCtx, analyser, sourceNode;
function ensureAudioContext(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  sourceNode = audioCtx.createMediaElementSource(radio);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  sourceNode.connect(analyser);
  analyser.connect(audioCtx.destination);
  const data = new Uint8Array(analyser.frequencyBinCount);
  (function meterLoop(){
    analyser.getByteFrequencyData(data);
    // compute average
    let sum = 0;
    for(let i=0;i<data.length;i++) sum += data[i];
    const avg = sum / data.length;
    const pct = Math.min(100, Math.round(avg / 2.5)); // scale
    vuBar.style.width = pct + '%';
    requestAnimationFrame(meterLoop);
  })();
}
radio.addEventListener('play', ()=> {
  ensureAudioContext();
});

/* ======= Knobs: interactive rotate-to-control =======
   Very lightweight: mousedown -> track mouse movement -> rotate knob
   Map tune knob angle to station index; volume knob angle to volume (0..1)
====================================================== */

function makeKnob(el, {startAngle=-60, endAngle=60, onChange}) {
  let dragging = false;
  let rect, center;
  function getAngle(e){
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - center.x;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - center.y;
    const a = Math.atan2(y,x) * 180 / Math.PI; // -180..180
    return a;
  }
  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function start(e){
    dragging = true;
    rect = el.getBoundingClientRect();
    center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', end);
    document.addEventListener('touchmove', onMove, {passive:false});
    document.addEventListener('touchend', end);
    e.preventDefault();
  }
  function onMove(e){
    if(!dragging) return;
    const a = getAngle(e); // -180..180
    // convert such that 0deg maps to the middle, clamp to range
    const bounded = clamp(a, startAngle, endAngle);
    const pct = (bounded - startAngle) / (endAngle - startAngle);
    onChange && onChange(pct, bounded);
    e.preventDefault();
  }
  function end(){
    dragging = false;
    document.removeEventListener('mousemove', onMove);
    document.removeEventListener('mouseup', end);
    document.removeEventListener('touchmove', onMove);
    document.removeEventListener('touchend', end);
  }
  el.addEventListener('mousedown', start);
  el.addEventListener('touchstart', start, {passive:false});
}

/* Tuning knob: map to station index */
const tuneIndicator = document.getElementById('tuneIndicator');
makeKnob(document.getElementById('tuneKnob'), {
  startAngle: -120, endAngle: 120,
  onChange: (pct, angle) => {
    // rotate visual
    tuneIndicator.style.transform = 'rotate(' + angle + 'deg)';
    // pick station based on pct
    const newIndex = Math.round(pct * (stations.length - 1));
    if(newIndex !== idx) {
      setStation(newIndex);
      // auto-start when user tunes
      startPlayback();
    }
  }
});

/* Volume knob */
const volIndicator = document.getElementById('volIndicator');
makeKnob(document.getElementById('volKnob'), {
  startAngle: -60, endAngle: 60,
  onChange: (pct, angle) => {
    const vol = Math.max(0, Math.min(1, pct));
    radio.volume = vol;
    volIndicator.style.transform = 'rotate(' + angle + 'deg)';
  }
});

// clicking volume knob toggles mute
document.getElementById('volKnob').addEventListener('click', ()=>{
  radio.muted = !radio.muted;
  document.getElementById('volKnob').style.filter = radio.muted ? 'grayscale(80%)' : 'none';
});

/* Helpful note:
   - If you want the knobs to move parts of the actual 3D model (e.g., rotate knob meshes),
     we can replace the Sketchfab iframe with a Three.js GLTFLoader and manipulate mesh rotations directly.
   - If you'd like that, provide the model GLB/GLTF download or I can fetch and convert it for you.
*/

</script>
</body>
</html><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Working 3D Vintage Radio (Sketchfab)</title>
<style>
  :root{ --bg:#0b0b0b; --panel:#111; --accent:#d9b86a; --muted:#999;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#050505 0%, #0f0f11 100%);font-family:Inter,system-ui,Arial;}
  .wrap{max-width:1200px;margin:18px auto;padding:12px;display:grid;grid-template-columns:1fr 340px;gap:18px;}
  .viewer {
    background: #000; border-radius:12px; overflow:hidden; min-height:520px; position:relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  }
  /* Sketchfab iframe fills viewer */
  .viewer iframe{width:100%;height:100%;border:0;display:block;}

  .controls {
    background: linear-gradient(180deg,#0f1113,#0b0d0f);
    border-radius:12px;padding:18px;color:#eee;box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    display:flex;flex-direction:column;gap:12px;
  }

  .title { font-size:18px; font-weight:600; margin-bottom:6px; color:var(--accent); }
  .station { font-size:14px; color:#ddd; margin-bottom:8px; }
  .knobs { display:flex; gap:14px; align-items:center; justify-content:space-between; padding:8px 0; }
  .knob {
    width:110px;height:110px;border-radius:50%; background:linear-gradient(180deg,#222,#111);display:flex;
    align-items:center;justify-content:center;position:relative;cursor:grab;
    box-shadow: inset 0 -6px 12px rgba(0,0,0,0.6), 0 6px 14px rgba(0,0,0,0.5);
  }
  .knob:active{cursor:grabbing;}
  .knob .indicator { position:absolute; width:4px; height:38px; top:12px; left:50%; transform-origin:50% 90%; background:var(--accent); border-radius:2px; }
  .label { text-align:center;margin-top:8px;font-size:13px;color:var(--muted); }
  button.small { background:#16181a;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:#ddd;cursor:pointer; }
  .vu { height:8px;background:#222;border-radius:6px;overflow:hidden; }
  .vu > i { display:block;height:100%;width:0%;background:linear-gradient(90deg,#c7d83b,#f15a24);transition:width 120ms linear; }
  .stations-list{display:flex;flex-direction:column;gap:6px; max-height:160px; overflow:auto; padding-right:6px;}
  .station-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:#ddd;text-align:left;cursor:pointer;}
  .attribution{font-size:12px;color:var(--muted); margin-top:6px;}
  .attribution a{color:var(--accent);text-decoration:none;}
  footer{max-width:1200px;margin:12px auto;color:#999;font-size:12px;padding:0 12px;}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr; padding:12px;}
    .controls{order:2;}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="viewer" id="viewer">
    <!-- Sketchfab embed (model from the link you gave) -->
    <!-- Model UID: 174423542ed8409aaac4ebefcaa8d0ae -->
    <iframe title="Car Radio - Sketchfab" src="https://sketchfab.com/models/174423542ed8409aaac4ebefcaa8d0ae/embed?autostart=0&preload=1"
      frameborder="0" allow="autoplay; fullscreen; vr" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe>
    <!-- If you prefer direct GLB loading later, we can swap this out for a Three.js GLTFLoader version -->
  </div>

  <aside class="controls">
    <div>
      <div class="title">Working 3D Vintage Radio</div>
      <div class="station" id="stationLabel">Station: —</div>
      <div class="vu"><i id="vuBar" style="width:0%"></i></div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;">
      <div style="flex:1">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">Tuning</div>
        <div class="knobs">
          <div class="knob" id="tuneKnob" data-angle="0" title="Drag to tune">
            <div class="indicator" id="tuneIndicator" style="transform:rotate(0deg)"></div>
          </div>
        </div>
        <div class="label">Rotate to change station</div>
      </div>

      <div style="width:120px">
        <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">Volume</div>
        <div class="knob" id="volKnob" data-angle="-45" title="Drag to change volume">
          <div class="indicator" id="volIndicator" style="transform:rotate(-45deg)"></div>
        </div>
        <div class="label">Drag / click to mute</div>
      </div>
    </div>

    <div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:8px;">Stations</div>
      <div class="stations-list" id="stationsList"></div>
    </div>

    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="small" id="prevBtn">◀ Prev</button>
      <button class="small" id="playPauseBtn">Play</button>
      <button class="small" id="nextBtn">Next ▶</button>
    </div>

    <div class="attribution">
      Model: <a href="https://sketchfab.com/3d-models/car-radio-174423542ed8409aaac4ebefcaa8d0ae" target="_blank" rel="noopener">Car Radio by Nohal (xMatlies)</a> — CC BY-SA.
    </div>
  </aside>
</div>

<footer style="text-align:center;">
  Built with Sketchfab embed • Streams sourced from public archive sources for demo.
</footer>

<!-- Audio element kept hidden -->
<audio id="radio" crossorigin="anonymous"></audio>

<script>
/* ======= Stations (change or add your own URLs) =======
   Use CORS-friendly streams (some radio streams block cross-origin requests).
   I included example archive.org MP3s as reliable demo sources.
====================================================== */
const stations = [
  { name: "Old Time Radio — The Shadow (example)", url: "https://archive.org/download/OTR_Theater/OTR_Theatre1.mp3" },
  { name: "Vintage Mix (example)", url: "https://archive.org/download/OTR_Philadelphia_Theater/Phil_Radio_1.mp3" },
  { name: "Public Domain Music (example)", url: "https://archive.org/download/testmp3testfile/mpthreetest.mp3" }
];

const radio = document.getElementById('radio');
let idx = 0;
let playing = false;

const stationLabel = document.getElementById('stationLabel');
const stationsList = document.getElementById('stationsList');
const vuBar = document.getElementById('vuBar');

function populateStations(){
  stationsList.innerHTML = '';
  stations.forEach((s,i)=>{
    const btn = document.createElement('button');
    btn.className = 'station-btn';
    btn.textContent = (i+1) + ". " + s.name;
    btn.onclick = ()=> { setStation(i); startPlayback(); };
    stationsList.appendChild(btn);
  });
}
populateStations();

function setStation(i){
  idx = i;
  radio.src = stations[idx].url;
  stationLabel.textContent = "Station: " + stations[idx].name;
}

function startPlayback(){
  radio.play().catch(e=>{
    // autoplay might be blocked until user interacts — that's fine
    console.log("Playback blocked: user gesture required.", e);
  });
  playing = true;
  document.getElementById('playPauseBtn').textContent = "Pause";
}
function pausePlayback(){
  radio.pause();
  playing = false;
  document.getElementById('playPauseBtn').textContent = "Play";
}

document.getElementById('prevBtn').onclick = ()=>{
  idx = (idx - 1 + stations.length) % stations.length; setStation(idx); startPlayback();
};
document.getElementById('nextBtn').onclick = ()=>{
  idx = (idx + 1) % stations.length; setStation(idx); startPlayback();
};
document.getElementById('playPauseBtn').onclick = ()=>{
  if(!playing){ startPlayback() } else { pausePlayback() }
};

// init
setStation(0);

/* ======= Simple VU meter using WebAudio API ======= */
let audioCtx, analyser, sourceNode;
function ensureAudioContext(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  sourceNode = audioCtx.createMediaElementSource(radio);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  sourceNode.connect(analyser);
  analyser.connect(audioCtx.destination);
  const data = new Uint8Array(analyser.frequencyBinCount);
  (function meterLoop(){
    analyser.getByteFrequencyData(data);
    // compute average
    let sum = 0;
    for(let i=0;i<data.length;i++) sum += data[i];
    const avg = sum / data.length;
    const pct = Math.min(100, Math.round(avg / 2.5)); // scale
    vuBar.style.width = pct + '%';
    requestAnimationFrame(meterLoop);
  })();
}
radio.addEventListener('play', ()=> {
  ensureAudioContext();
});

/* ======= Knobs: interactive rotate-to-control =======
   Very lightweight: mousedown -> track mouse movement -> rotate knob
   Map tune knob angle to station index; volume knob angle to volume (0..1)
====================================================== */

function makeKnob(el, {startAngle=-60, endAngle=60, onChange}) {
  let dragging = false;
  let rect, center;
  function getAngle(e){
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - center.x;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - center.y;
    const a = Math.atan2(y,x) * 180 / Math.PI; // -180..180
    return a;
  }
  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function start(e){
    dragging = true;
    rect = el.getBoundingClientRect();
    center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', end);
    document.addEventListener('touchmove', onMove, {passive:false});
    document.addEventListener('touchend', end);
    e.preventDefault();
  }
  function onMove(e){
    if(!dragging) return;
    const a = getAngle(e); // -180..180
    // convert such that 0deg maps to the middle, clamp to range
    const bounded = clamp(a, startAngle, endAngle);
    const pct = (bounded - startAngle) / (endAngle - startAngle);
    onChange && onChange(pct, bounded);
    e.preventDefault();
  }
  function end(){
    dragging = false;
    document.removeEventListener('mousemove', onMove);
    document.removeEventListener('mouseup', end);
    document.removeEventListener('touchmove', onMove);
    document.removeEventListener('touchend', end);
  }
  el.addEventListener('mousedown', start);
  el.addEventListener('touchstart', start, {passive:false});
}

/* Tuning knob: map to station index */
const tuneIndicator = document.getElementById('tuneIndicator');
makeKnob(document.getElementById('tuneKnob'), {
  startAngle: -120, endAngle: 120,
  onChange: (pct, angle) => {
    // rotate visual
    tuneIndicator.style.transform = 'rotate(' + angle + 'deg)';
    // pick station based on pct
    const newIndex = Math.round(pct * (stations.length - 1));
    if(newIndex !== idx) {
      setStation(newIndex);
      // auto-start when user tunes
      startPlayback();
    }
  }
});

/* Volume knob */
const volIndicator = document.getElementById('volIndicator');
makeKnob(document.getElementById('volKnob'), {
  startAngle: -60, endAngle: 60,
  onChange: (pct, angle) => {
    const vol = Math.max(0, Math.min(1, pct));
    radio.volume = vol;
    volIndicator.style.transform = 'rotate(' + angle + 'deg)';
  }
});

// clicking volume knob toggles mute
document.getElementById('volKnob').addEventListener('click', ()=>{
  radio.muted = !radio.muted;
  document.getElementById('volKnob').style.filter = radio.muted ? 'grayscale(80%)' : 'none';
});

/* Helpful note:
   - If you want the knobs to move parts of the actual 3D model (e.g., rotate knob meshes),
     we can replace the Sketchfab iframe with a Three.js GLTFLoader and manipulate mesh rotations directly.
   - If you'd like that, provide the model GLB/GLTF download or I can fetch and convert it for you.
*/

</script>
</body>
</html>
